{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://mosberg.github.io/schemas/brewing/equipment-schema.json",
  "title": "Brewing Equipment Definition",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "type",
    "schema_version",
    "id",
    "name_key",
    "rarity",
    "material",
    "function",
    "category",
    "placement",
    "inventory",
    "aging",
    "client",
    "gates",
    "text"
  ],
  "properties": {
    "type": {
      "const": "brewing:equipment"
    },
    "schema_version": {
      "type": "integer",
      "minimum": 1
    },
    "id": {
      "$ref": "common-schema.json#/$defs/Identifier"
    },
    "name_key": {
      "type": "string",
      "minLength": 1
    },
    "rarity": {
      "$ref": "common-schema.json#/$defs/Rarity"
    },
    "material": {
      "$ref": "#/$defs/MaterialKind"
    },
    "function": {
      "$ref": "#/$defs/EquipmentFunction"
    },
    "category": {
      "type": "string",
      "minLength": 1
    },
    "meta": {
      "$ref": "#/$defs/Meta"
    },
    "placement": {
      "$ref": "#/$defs/Placement"
    },
    "inventory": {
      "$ref": "#/$defs/Inventory"
    },
    "aging": {
      "$ref": "#/$defs/Processing"
    },
    "processing": {
      "type": "object",
      "description": "Optional modern alias for 'aging' (future migration).",
      "additionalProperties": true
    },
    "interaction": {
      "$ref": "#/$defs/Interaction"
    },
    "automation": {
      "$ref": "#/$defs/Automation"
    },
    "upgrades": {
      "$ref": "#/$defs/Upgrades"
    },
    "wood_variants": {
      "$ref": "#/$defs/WoodVariants"
    },
    "metal_variants": {
      "$ref": "#/$defs/MetalVariants"
    },
    "crafting": {
      "$ref": "#/$defs/Crafting"
    },
    "client": {
      "$ref": "#/$defs/Client"
    },
    "gates": {
      "$ref": "#/$defs/Gates"
    },
    "text": {
      "$ref": "#/$defs/Text"
    },
    "config": {
      "$ref": "#/$defs/Config"
    },
    "events": {
      "$ref": "#/$defs/Events"
    }
  },
  "$defs": {
    "MaterialKind": {
      "enum": [
        "wood",
        "metal",
        "glass",
        "stone",
        "cloth"
      ]
    },
    "EquipmentFunction": {
      "enum": [
        "mashing",
        "maceration",
        "fermentation",
        "filtration",
        "conditioning",
        "distillation",
        "aging"
      ]
    },
    "FacingRule": {
      "enum": [
        "none",
        "horizontal",
        "vertical",
        "all"
      ]
    },
    "Meta": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "display_name": {
          "type": "string"
        },
        "icon": {
          "type": "string"
        },
        "notes": {
          "type": "string"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "uniqueItems": true
        }
      }
    },
    "Placement": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "block_id",
        "block_entity_id",
        "facing",
        "requires_solid_support"
      ],
      "properties": {
        "kind": {
          "enum": [
            "block"
          ]
        },
        "block_id": {
          "$ref": "common-schema.json#/$defs/Identifier"
        },
        "block_entity_id": {
          "type": "string",
          "minLength": 1
        },
        "facing": {
          "$ref": "#/$defs/FacingRule"
        },
        "requires_solid_support": {
          "type": "boolean"
        },
        "valid_dimensions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "uniqueItems": true
        },
        "requires_biome_tag": {
          "type": "string"
        },
        "requires_light_level_at_most": {
          "type": "integer",
          "minimum": 0,
          "maximum": 15
        },
        "requires_light_level_at_least": {
          "type": "integer",
          "minimum": 0,
          "maximum": 15
        },
        "placement_rules": {
          "type": "object",
          "description": "Extension point: arbitrary placement constraints (structures, adjacency rules, etc.).",
          "additionalProperties": true
        }
      }
    },
    "SlotRole": {
      "enum": [
        "input",
        "output",
        "fuel",
        "catalyst",
        "aging_input",
        "processing_input",
        "processing_output",
        "byproduct",
        "upgrade"
      ]
    },
    "Inventory": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "capacity",
        "stack_limit_per_slot",
        "accepts_item_tags",
        "rejects_item_tags",
        "slot_roles",
        "quick_move"
      ],
      "properties": {
        "capacity": {
          "type": "integer",
          "minimum": 0
        },
        "stack_limit_per_slot": {
          "type": "integer",
          "minimum": 1,
          "maximum": 64
        },
        "accepts_item_tags": {
          "type": "array",
          "items": {
            "$ref": "common-schema.json#/$defs/TagId"
          },
          "uniqueItems": true
        },
        "rejects_item_tags": {
          "type": "array",
          "items": {
            "$ref": "common-schema.json#/$defs/TagId"
          },
          "uniqueItems": true
        },
        "accepts_items": {
          "type": "array",
          "items": {
            "$ref": "common-schema.json#/$defs/Identifier"
          },
          "uniqueItems": true
        },
        "rejects_items": {
          "type": "array",
          "items": {
            "$ref": "common-schema.json#/$defs/Identifier"
          },
          "uniqueItems": true
        },
        "slot_roles": {
          "type": "object",
          "description": "Key is a slot index or range like '0-3'. Value is a role.",
          "additionalProperties": {
            "$ref": "#/$defs/SlotRole"
          },
          "propertyNames": {
            "pattern": "^[0-9]+(-[0-9]+)?$"
          }
        },
        "quick_move": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "enabled",
            "priority"
          ],
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "priority": {
              "type": "array",
              "items": {
                "$ref": "#/$defs/SlotRole"
              },
              "uniqueItems": true
            }
          }
        },
        "slot_filters": {
          "type": "object",
          "description": "Optional per-slot filtering rules (more precise than accepts/rejects).",
          "additionalProperties": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "accepts_item_tags": {
                "type": "array",
                "items": {
                  "$ref": "common-schema.json#/$defs/TagId"
                },
                "uniqueItems": true
              },
              "rejects_item_tags": {
                "type": "array",
                "items": {
                  "$ref": "common-schema.json#/$defs/TagId"
                },
                "uniqueItems": true
              },
              "accepts_items": {
                "type": "array",
                "items": {
                  "$ref": "common-schema.json#/$defs/Identifier"
                },
                "uniqueItems": true
              },
              "rejects_items": {
                "type": "array",
                "items": {
                  "$ref": "common-schema.json#/$defs/Identifier"
                },
                "uniqueItems": true
              }
            }
          }
        }
      }
    },
    "Processing": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "recipe_source",
        "recipe_type",
        "aging_multiplier",
        "progress_persists"
      ],
      "properties": {
        "recipe_source": {
          "enum": [
            "data",
            "datapack"
          ]
        },
        "recipe_type": {
          "$ref": "common-schema.json#/$defs/Identifier"
        },
        "aging_multiplier": {
          "type": "number",
          "minimum": 0
        },
        "progress_persists": {
          "type": "boolean"
        },
        "ticks_per_cycle": {
          "type": "integer",
          "minimum": 1,
          "description": "Optional fixed processing tick rate (lets you decouple from world tick speed or apply throttling)."
        },
        "batch_size": {
          "type": "integer",
          "minimum": 1,
          "description": "Optional: how many recipe executions can run per cycle when inputs allow."
        },
        "quality": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "base_quality": {
              "type": "number"
            },
            "base_quality_on_insert": {
              "type": "number"
            },
            "max_quality": {
              "type": "number"
            },
            "min_quality": {
              "type": "number"
            },
            "quality_variance": {
              "type": "number",
              "minimum": 0
            },
            "quality_bonus_on_complete": {
              "type": "number"
            },
            "skill_influence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1
            }
          }
        },
        "spoilage": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "base_risk_per_day": {
              "type": "number",
              "minimum": 0
            },
            "base_spoilage_rate": {
              "type": "number",
              "minimum": 0
            },
            "opened_multiplier": {
              "type": "number",
              "minimum": 0
            },
            "contamination_tags": {
              "type": "array",
              "items": {
                "$ref": "common-schema.json#/$defs/TagId"
              },
              "uniqueItems": true
            },
            "spoiled_output_id": {
              "$ref": "common-schema.json#/$defs/Identifier"
            }
          }
        },
        "environment_modifiers": {
          "type": "object",
          "description": "Machine-specific environment logic knobs (temperature/pressure/humidity/heat sources/etc.).",
          "additionalProperties": {
            "type": "object",
            "additionalProperties": true
          }
        },
        "energy": {
          "type": "object",
          "description": "Optional unified energy/fuel model (supports fuel, power, or both).",
          "additionalProperties": false,
          "properties": {
            "requires_fuel": {
              "type": "boolean"
            },
            "fuel_slot_role": {
              "$ref": "#/$defs/SlotRole"
            },
            "fuel_burn_time_ticks": {
              "type": "integer",
              "minimum": 0
            },
            "requires_power": {
              "type": "boolean"
            },
            "power_unit": {
              "type": "string"
            },
            "power_per_tick": {
              "type": "number",
              "minimum": 0
            },
            "consumption_per_tick": {
              "type": "number",
              "minimum": 0
            }
          }
        }
      }
    },
    "InteractionAction": {
      "enum": [
        "open_ui",
        "quick_extract",
        "rotate",
        "toggle",
        "none"
      ]
    },
    "Interaction": {
      "type": "object",
      "description": "Supports both 'open_gui_on_use' style and (right/shift-right) action style.",
      "additionalProperties": false,
      "properties": {
        "open_gui_on_use": {
          "type": "boolean"
        },
        "right_click_action": {
          "$ref": "#/$defs/InteractionAction"
        },
        "shift_right_click_action": {
          "$ref": "#/$defs/InteractionAction"
        },
        "requires_sneak_to_extract": {
          "type": "boolean"
        },
        "sound_on_open": {
          "type": "string"
        },
        "sound_on_close": {
          "type": "string"
        },
        "allow_automation": {
          "type": "boolean"
        },
        "requires_fuel": {
          "type": "boolean"
        },
        "lockable": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "lock_item_tag": {
              "type": "string"
            },
            "owner_only_by_default": {
              "type": "boolean"
            }
          }
        },
        "permissions": {
          "type": "object",
          "description": "Optional ownership/trust model for multi-player servers.",
          "additionalProperties": false,
          "properties": {
            "owner_only": {
              "type": "boolean"
            },
            "trust_list_tag": {
              "type": "string"
            }
          }
        }
      }
    },
    "SidedRule": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "insert",
        "extract"
      ],
      "properties": {
        "insert": {
          "type": "boolean"
        },
        "extract": {
          "type": "boolean"
        }
      }
    },
    "Automation": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "hopper_insert": {
          "type": "boolean"
        },
        "hopper_extract": {
          "type": "boolean"
        },
        "supports_hoppers": {
          "type": "boolean"
        },
        "supports_pipes": {
          "type": "boolean"
        },
        "redstone_controllable": {
          "type": "boolean"
        },
        "comparator_output": {
          "type": "string"
        },
        "pipe_sides": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "sided_rules": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "top": {
              "$ref": "#/$defs/SidedRule"
            },
            "sides": {
              "$ref": "#/$defs/SidedRule"
            },
            "bottom": {
              "$ref": "#/$defs/SidedRule"
            }
          }
        }
      }
    },
    "Upgrades": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "enabled",
        "slots",
        "allowed_upgrade_tags",
        "effects"
      ],
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "slots": {
          "type": "integer",
          "minimum": 0
        },
        "allowed_upgrade_tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "uniqueItems": true
        },
        "effects": {
          "type": "object",
          "description": "Either numeric knobs or structured effect objects; kept open-ended for iteration.",
          "additionalProperties": {
            "oneOf": [
              {
                "type": "number"
              },
              {
                "type": "object",
                "additionalProperties": true
              }
            ]
          }
        }
      }
    },
    "WoodVariants": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "supports_variants": {
          "type": "boolean"
        },
        "default_wood": {
          "type": "string"
        },
        "allowed_woods": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "uniqueItems": true
        },
        "allowed_types": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "uniqueItems": true
        },
        "wood_affects_flavor": {
          "type": "boolean"
        },
        "flavor_bias": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        }
      }
    },
    "MetalVariants": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "default_metal": {
          "type": "string"
        },
        "allowed_metals": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "uniqueItems": true
        },
        "coating": {
          "type": "string"
        }
      }
    },
    "Client": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "screen_id",
        "show_progress",
        "show_quality",
        "show_environment_state"
      ],
      "properties": {
        "screen_id": {
          "type": "string"
        },
        "show_progress": {
          "type": "boolean"
        },
        "show_quality": {
          "type": "boolean"
        },
        "show_environment_state": {
          "type": "boolean"
        },
        "block_entity_renderer": {
          "type": "string"
        },
        "animated": {
          "type": "boolean"
        },
        "particles": {
          "type": "boolean"
        }
      }
    },
    "Gates": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "requires_feature_flag",
        "requires_gamerule_true"
      ],
      "properties": {
        "requires_feature_flag": {
          "type": "string"
        },
        "requires_gamerule_true": {
          "type": "string"
        },
        "min_player_level": {
          "type": "integer",
          "minimum": 0
        },
        "requires_mods": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "uniqueItems": true
        }
      }
    },
    "Text": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "name_key",
        "tooltip_key"
      ],
      "properties": {
        "name_key": {
          "type": "string"
        },
        "tooltip_key": {
          "type": "string"
        },
        "lore_key": {
          "type": "string"
        }
      }
    },
    "Crafting": {
      "type": "object",
      "description": "Optional recipe hints / definitions.",
      "additionalProperties": true,
      "properties": {
        "recipe_type": {
          "type": "string"
        },
        "recipe_id": {
          "$ref": "common-schema.json#/$defs/Identifier"
        },
        "ingredients": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "pattern": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "recipe_hint": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "Config": {
      "type": "object",
      "description": "Global toggles and multipliers applied at runtime.",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "speed_multiplier": {
          "type": "number",
          "minimum": 0,
          "default": 1.0
        },
        "energy_multiplier": {
          "type": "number",
          "minimum": 0,
          "default": 1.0
        },
        "quality_multiplier": {
          "type": "number",
          "minimum": 0,
          "default": 1.0
        },
        "allow_automation": {
          "type": "boolean",
          "default": true
        },
        "debug_logging": {
          "type": "boolean",
          "default": false
        }
      }
    },
    "Events": {
      "type": "object",
      "description": "Optional data-driven hooks for scripting-like behavior.",
      "additionalProperties": false,
      "properties": {
        "on_tick": {
          "$ref": "common-schema.json#/$defs/EventList"
        },
        "on_start": {
          "$ref": "common-schema.json#/$defs/EventList"
        },
        "on_complete": {
          "$ref": "common-schema.json#/$defs/EventList"
        },
        "on_fail": {
          "$ref": "common-schema.json#/$defs/EventList"
        },
        "on_open": {
          "$ref": "common-schema.json#/$defs/EventList"
        },
        "on_close": {
          "$ref": "common-schema.json#/$defs/EventList"
        }
      }
    }
  },
  "patternProperties": {
    "^x-": {
      "type": [
        "object",
        "array",
        "string",
        "number",
        "integer",
        "boolean",
        "null"
      ]
    },
    "^_debug$": {
      "type": "object",
      "additionalProperties": true
    }
  }
}
